# jenkins-values.yaml
controller:
  image:
    repository: jenkins/jenkins
    tag: "2.452.2-jdk17"
    pullPolicy: IfNotPresent

  admin:
    username: admin
    password: admin

  installPlugins:
    - kubernetes
    - workflow-aggregator
    - git
    - docker-workflow
    - blueocean
    - configuration-as-code

  JCasC:
    enabled: false

  sidecars:
    configAutoReload:
      enabled: false

    dind:
      enabled: true
      image: docker:24-dind
      securityContext:
        privileged: true
      args:
        - --host=tcp://localhost:2375
        - --host=unix:///var/run/docker.sock
      env:
        - name: DOCKER_TLS_CERTDIR
          value: ""
      volumeMounts:
        - name: docker-storage
          mountPath: /var/lib/docker

  initContainers:
    - name: install-docker-cli
      image: docker:24-cli
      command: ["sh", "-c", "cp $(which docker) /docker-bin/docker"]
      volumeMounts:
        - name: docker-bin
          mountPath: /docker-bin

  securityContext:
    runAsUser: 1000
    fsGroup: 1000

  podAnnotations:
    container.apparmor.security.beta.kubernetes.io/jenkins: unconfined

  volumes:
    - name: docker-storage
      emptyDir: {}

    - name: docker-bin
      emptyDir: {}

  volumeMounts:
    - name: docker-bin
      mountPath: /usr/local/bin

  containerEnv:
    - name: PATH
      value: "/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"

persistence:
  enabled: true
  storageClass: local-path
  size: 8Gi
  existingClaim: ""

service:
  type: NodePort
  nodePort: 32000