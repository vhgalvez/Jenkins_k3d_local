# jenkins-values.yaml
controller:
  image:
    repository: jenkins/jenkins
    tag: "2.504.3-jdk17"
    pullPolicy: IfNotPresent

  admin:
    existingSecret: jenkins-admin
    userKey: jenkins-admin-user
    passwordKey: jenkins-admin-password

  installPlugins:
    - configuration-as-code
    - sse-gateway:1.29

  JCasC:
    enabled: true
    defaultConfig: false
    configScripts:
      main: |
        jenkins:
          securityRealm:
            local:
              allowsSignup: false
              # Sólo un usuario, sin clouds ni plantillas todavía
              users:
                - id: "${JENKINS_ADMIN_USER}"
                  password: "${JENKINS_ADMIN_PASSWORD}"
          authorizationStrategy:
            loggedInUsersCanDoAnything:
              allowAnonymousRead: false

  # Inyectamos las env vars para JCasC
  containerEnv:
    - name: JENKINS_ADMIN_USER
      valueFrom:
        secretKeyRef:
          name: jenkins-admin
          key: jenkins-admin-user
    - name: JENKINS_ADMIN_PASSWORD
      valueFrom:
        secretKeyRef:
          name: jenkins-admin
          key: jenkins-admin-password

  sidecars:
    configAutoReload:
      enabled: false

persistence:
  enabled: true
  storageClass: local-path
  size: 8Gi

service:
  type: NodePort
  nodePort: 32000