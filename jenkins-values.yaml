controller:
  image:
    tag: "lts" # versión de la imagen jenkins/jenkins

  ## Credenciales iniciales
  admin:
    username: admin # ¡cámbialas luego!
    password: admin

  ## Plugins imprescindibles
  installPlugins:
    - docker-workflow:1.28
    - workflow-aggregator:2.7
    - git:4.11.0
    - credentials:1144.v76b_089ccd026
    - credentials-binding:1.27
    - blueocean:1.25.0

  ## Sidecar Docker-in-Docker
  sidecars:
    dind:
      image: docker:24-dind
      securityContext:
        privileged: true
      args:
        - --host=tcp://localhost:2375
        - --host=unix:///var/run/docker.sock
      env:
        - name: DOCKER_TLS_CERTDIR
          value: ""
      volumeMounts:
        - name: docker-graph-storage
          mountPath: /var/lib/docker

  ## Volúmenes efímeros locales
  volumes:
    - name: docker-graph-storage
      emptyDir: {}
    - name: docker-binary
      emptyDir: {}

  ## InitContainer: instala docker-cli
  initContainers:
    - name: install-docker-cli
      image: alpine:3.19
      command:
        - sh
        - -c
        - |
          apk add --no-cache docker-cli
          cp /usr/bin/docker /binary/docker
      volumeMounts:
        - name: docker-binary
          mountPath: /binary

  ## Añadir /binary al PATH
  containerEnv:
    - name: PATH
      value: "/binary:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"

## Persistencia con local-path (nativo en K3d/K3s, no instala nada extra)
persistence:
  enabled: true
  storageClass: local-path
  size: 4Gi